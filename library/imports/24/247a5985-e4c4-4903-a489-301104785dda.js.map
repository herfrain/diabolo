{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\biabolo.js"],"names":["cc","Class","extends","Component","properties","x","y","x_speed","y_speed","isFly","rigidbody","mouseJoint","ropes","default","type","Node","rope","physicsBoxCollider","leftNode","rightNode","leftJoint","onLoad","node","on","EventType","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","TOUCH_CANCEL","getComponent","RigidBody","ropeList","children","getChildByName","DistanceJoint","rightJoint","MouseJoint","PhysicsBoxCollider","enabled","log","touchBegin","event","console","info","calV2","k","leftnode_wp","convertToWorldSpaceAR","v2","rightnode_wp","diabolo_wp","f1","sub","f2","result_v2","add","scale","linearVelocity","cancelLRJoint","destroy","connectedBody","apply","bandLRJoint","other","bandMouseJoint","addComponent","start","onCollisionEnter","self","onCollisionExit","update","dt"],"mappings":"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","file":"biabolo.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        x:0,//x坐标\r\n        y:0,//y坐标\r\n        x_speed:0,//x轴方向速度\r\n        y_speed:0,//y轴方向速度\r\n        isFly:false,//是否正在飞行中\r\n        rigidbody:null,//刚体\r\n        mouseJoint:null,\r\n        ropes:{\r\n            default:null,\r\n            type:cc.Node\r\n        },//关联rope的父节点，可以通过这个父节点访问子节点\r\n        rope:null,//空竹所在的绳子\r\n        physicsBoxCollider:null,//物理墙\r\n        leftNode:null,//左连接点\r\n        rightNode:null,//右连接点\r\n        leftJoint:null,//左distanceJoint组件\r\n        leftJoint:null,//右distanceJoint组件\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        //注册Touch事件\r\n        // this.node.on(cc.Node.EventType.TOUCH_START,this.touchBegin,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE,this.touchMove,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END,this.touchEnd,this);//当手指在目标节点区域内离开屏幕时\r\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.touchEnd,this);//当手指在目标节点区域外离开屏幕时\r\n\r\n        //绑定刚体\r\n        this.rigidbody = this.node.getComponent(cc.RigidBody);\r\n        //绑定左右连接点\r\n        var ropeList=this.ropes.children;\r\n        this.rope=ropeList[0]\r\n        this.leftNode=this.rope.getChildByName(\"left\")\r\n        this.rightNode=this.rope.getChildByName(\"right\")\r\n        //绑定左右distanceJoint组件\r\n        this.leftJoint=this.leftNode.getComponent(cc.DistanceJoint)\r\n        this.rightJoint=this.rightNode.getComponent(cc.DistanceJoint)\r\n        //绑定mouseJoint\r\n        this.mouseJoint=this.node.getComponent(cc.MouseJoint)\r\n        //绑定物理碰撞\r\n        this.physicsBoxCollider=this.rope.getComponent(cc.PhysicsBoxCollider)\r\n        this.physicsBoxCollider.enabled=true\r\n        cc.log(\"mouseJoint是否可用：\"+this.mouseJoint.enabled)\r\n        cc.log(this.mouseJoint)\r\n        cc.log(this.rigidbody)\r\n        cc.log(this.leftNode)\r\n        cc.log(this.leftJoint)\r\n    },\r\n\r\n    touchBegin:function(event){\r\n        console.info(\"begin\")\r\n       \r\n    },\r\n\r\n    touchMove:function(event){\r\n        console.info(\"move\")\r\n        //如果空竹比绳子高，则不能往上拉动\r\n    },\r\n\r\n    /**\r\n     * 放手后，与当前左右连接点解绑\r\n     * 空竹沿着两边固定点的中心方向射出\r\n     * 初速度与拉伸程度有关\r\n     * @param {*} event \r\n     */\r\n\r\n    //计算速度向量\r\n    calV2:function(){\r\n        // var biabolo_v2=this.rigidbody.getWorldVector();\r\n        // var rope_v2=this.rope.getWorldVector();\r\n        var k=5.5//系数，可调\r\n        // var f1=this.leftJoint.getReactionForce(1)//获取反作用力\r\n        // var f2=this.rightJoint.getReactionForce(1)\r\n        var leftnode_wp=this.leftNode.convertToWorldSpaceAR(cc.v2(0,0))//左节点的世界坐标向量\r\n        var rightnode_wp=this.rightNode.convertToWorldSpaceAR(cc.v2(0,0))\r\n        var diabolo_wp=this.node.convertToWorldSpaceAR(cc.v2(0,0))\r\n        var f1=leftnode_wp.sub(diabolo_wp)//左上拉力向量\r\n        var f2=rightnode_wp.sub(diabolo_wp)\r\n        var result_v2=f1.add(f2)\r\n        result_v2=result_v2.scale(cc.v2(k,k))//乘一个系数，放大作用力\r\n        cc.log(f1)\r\n        cc.log(f2)\r\n        cc.log(result_v2)\r\n        return result_v2\r\n    },\r\n\r\n    touchEnd:function(event){\r\n        console.info(\"end\")\r\n\r\n        if(!this.isFly){\r\n            //给个初速度向量，相当于射出去\r\n            this.rigidbody.linearVelocity=this.calV2()\r\n            //删除两端连接点\r\n            this.cancelLRJoint()\r\n            //删除拉动点mouseJoint\r\n            this.mouseJoint.destroy()\r\n            this.mouseJoint=null\r\n            //设置为飞行状态\r\n            this.isFly=true\r\n            //开门\r\n            this.physicsBoxCollider.enabled=false\r\n        }\r\n        // this.bandMouseJoint()\r\n        // cc.log(this.mouseJoint)\r\n    },\r\n\r\n    //取消左右节点绑定\r\n    cancelLRJoint:function(){\r\n        this.leftJoint.enabled=false\r\n        this.leftJoint.connectedBody=null\r\n        this.rightJoint.enabled=false\r\n        this.rightJoint.connectedBody=null\r\n        this.leftJoint.apply()\r\n        this.rightJoint.apply()\r\n    },\r\n\r\n    //绑定左右节点\r\n    bandLRJoint:function(other){\r\n        //绑定左右连接点\r\n        this.rope=other.node\r\n        this.leftNode=this.rope.getChildByName(\"left\")\r\n        this.rightNode=this.rope.getChildByName(\"right\")\r\n        //绑定左右distanceJoint组件\r\n        this.leftJoint=this.leftNode.getComponent(cc.DistanceJoint)\r\n        this.rightJoint=this.rightNode.getComponent(cc.DistanceJoint)\r\n        this.leftJoint.connectedBody=this.rigidbody\r\n        this.rightJoint.connectedBody=this.rigidbody\r\n        this.leftJoint.enabled=true\r\n        this.rightJoint.enabled=true\r\n        this.leftJoint.apply()//修改之后需要apply()才能真正设置完成\r\n        this.rightJoint.apply()\r\n    },\r\n\r\n\r\n    //重新绑定mousejoint\r\n    bandMouseJoint:function(){\r\n        this.node.addComponent(cc.MouseJoint)//添加组件\r\n        this.mouseJoint=this.node.getComponent(cc.MouseJoint)\r\n    },\r\n\r\n\r\n    start () {\r\n        \r\n    },\r\n\r\n    onCollisionEnter:function(other,self){\r\n        cc.log('enter')\r\n    },\r\n\r\n    //结束碰撞时，如果空竹是往下落的，则添加绳子\r\n    onCollisionExit: function (other, self) {\r\n        console.log('on collision enter');\r\n        if(this.rigidbody.linearVelocity.y<0){\r\n            //绑定左右节点\r\n            this.bandLRJoint(other)\r\n            cc.log(this.rope)\r\n            cc.log(this.leftJoint)\r\n            //绑定mouseJoint\r\n            this.bandMouseJoint()\r\n            // other.enabled=false\r\n            this.isFly=false//固定在绳子上\r\n            //关门\r\n            this.physicsBoxCollider.enabled=true\r\n        }\r\n\r\n\r\n    },\r\n\r\n    //在飞行时判断，如果落在另一条绳子上，则建立连接\r\n    update (dt) {\r\n        //var velocity = this.rigidbody.linearVelocity;\r\n        //console.info(this.rigidbody.getWorldPosition())\r\n        //this.rigidbody.linearVelocity = cc.v2(0,0);\r\n        //console.info(this.rigidbody.linearVelocity)\r\n\r\n        \r\n\r\n        //如果检测到与绳子发生碰撞，则建立两边点的链接，并将绑定mousejoint，飞行状态设为false\r\n    },\r\n});\r\n"]}