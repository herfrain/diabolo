{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\effects.js"],"names":["random","require","ItemType","IT_None","IT_BigStar","IT_SmallStar","IT_Pen","IT_Jump","effects","cc","Class","extends","Component","properties","camera","ropes","ropesNode","pickRadius","ItemPrefabList","default","type","Prefab","ItemRateList","Integer","_RandBaseNum","_RandRateList","_ItemPoolList","onLoad","find","getRandomNum","randNum","parseInt","Math","getItem","randomNum","createEffect","length","effectsNode","node","item","randRope","getRndIntegerUp","ropeX","x","ropeY","y","loader","loadRes","err","prefab","newNode","instantiate","console","log","addChild","children","start","schedule","update","dt","parent","height","num","i","isValid","destroy","module","exports"],"mappings":"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","file":"effects.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nvar random=require('random')\r\nvar ItemType = \r\n{\r\n    //没有东西\r\n    IT_None:0,\r\n    //变大\r\n    IT_BigStar:1,\r\n    //变小\r\n    IT_SmallStar:2,\r\n    //画辅助线\r\n    IT_Pen:3,\r\n    //跳高\r\n    IT_Jump:4,\r\n};\r\n\r\nvar effects = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        effects:null,\r\n        camera:null,\r\n        ropes:null,\r\n        ropesNode:null,\r\n\r\n        //拾取距离\r\n        pickRadius:0,\r\n\r\n       //物品Prefab列表\r\n       ItemPrefabList:\r\n       {\r\n           default: [],  \r\n           type: [cc.Prefab],\r\n       },\r\n\r\n       //概率列表\r\n       ItemRateList:\r\n       {\r\n           default:[],\r\n           type: [cc.Integer],                    \r\n       },\r\n\r\n       //随机的基数\r\n       _RandBaseNum : 100,\r\n       _RandRateList: [],\r\n       //物品池\r\n       _ItemPoolList: [],\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.camera=cc.find(\"Canvas/Main Camera\")\r\n        this.ropesNode=cc.find(\"Canvas/ropes\")\r\n    },\r\n\r\n    getRandomNum:function() {\r\n        //生成[0,5)的随机整数\r\n        var randNum = parseInt(Math.random()*4)+1;\r\n        return randNum;\r\n    },\r\n\r\n    getItem:function(randomNum) {\r\n        switch(randomNum) {\r\n            //没有东西\r\n            case 0:\r\n                return null;\r\n            //变大\r\n            case 1:\r\n                return 'star_big';\r\n            //变小\r\n            case 2:\r\n                return 'star_small';\r\n            //画辅助线\r\n            // case 3:\r\n            //     return 'pen';\r\n            //跳高\r\n            case 3:\r\n                return 'jump';\r\n            //上树\r\n            case 4:\r\n                return 'fly';\r\n        }\r\n    },\r\n\r\n    createEffect:function(){\r\n        if(this.effects.length>6){\r\n            return\r\n        }\r\n        var effectsNode=this.node\r\n        var randNum = this.getRandomNum();\r\n        //获得本次随机生成的道具\r\n        var item = this.getItem(randNum);\r\n        //随机某一根绳子\r\n        var randRope = 0\r\n        if(this.ropes.length-5>=0)\r\n            randRope = random.getRndIntegerUp(this.ropes.length-5,this.ropes.length-1);\r\n        //该绳子位置\r\n        var ropeX = this.ropes[randRope].x;\r\n        var ropeY = this.ropes[randRope].y;\r\n        //加载道具\r\n        cc.loader.loadRes(item, function(err, prefab) {\r\n            var newNode = cc.instantiate(prefab);\r\n            console.log(\"生成道具\");\r\n            // newNode.parent = effectsNode;//不知道为何，有时会是null？？？\r\n            // cc.log(ropeX)\r\n            newNode.x = ropeX+random.getRndIntegerUp(-80,80);\r\n            newNode.y = ropeY+random.getRndIntegerUp(-200,200);\r\n            effectsNode.addChild(newNode)\r\n            cc.log(\"道具数量：\"+effectsNode.children.length)\r\n        });\r\n    },\r\n\r\n    start () {\r\n        this.effects=this.node.children\r\n        this.ropes=this.ropesNode.children\r\n        // var effectsNode=this.node\r\n        // var timeCallback = function () {\r\n        //     // cc.log(this.ropes)\r\n        //     var randNum = this.getRandomNum();\r\n        //     //获得本次随机生成的道具\r\n        //     var item = this.getItem(randNum);\r\n        //     //随机某一根绳子\r\n        //     var randRope = 0\r\n        //     if(this.ropes.length-5>=0)\r\n        //         randRope = random.getRndIntegerUp(this.ropes.length-5,this.ropes.length-1);\r\n        //     //该绳子位置\r\n        //     var ropeX = this.ropes[randRope].x;\r\n        //     var ropeY = this.ropes[randRope].y;\r\n        //     //加载道具\r\n        //     cc.loader.loadRes(item, function(err, prefab) {\r\n        //         var newNode = cc.instantiate(prefab);\r\n        //         console.log(\"生成道具\");\r\n        //         // newNode.parent = effectsNode;//不知道为何，有时会是null？？？\r\n        //         cc.log(ropeX)\r\n        //         newNode.x = ropeX+random.getRndIntegerUp(-80,80);\r\n        //         newNode.y = ropeY+random.getRndIntegerUp(-200,200);\r\n        //         effectsNode.addChild(newNode)\r\n        //         cc.log(\"道具数量：\"+effectsNode.children.length)\r\n        //     });\r\n        // }\r\n        //if(random.newRndItem) {\r\n        this.schedule(this.createEffect, (Math.random()*10)+10 );\r\n    },\r\n\r\n    update (dt) {\r\n        // cc.log(this.effects.length)\r\n        // cc.log(this.camera.y+this.camera.parent.height>this.ropes[this.ropes.length-1].y)\r\n        if(this.camera.y+this.camera.parent.height>this.ropes[this.ropes.length-1].y){\r\n            cc.log(2)\r\n            var num=random.getRndIntegerUp(0,2)\r\n            for(var i=0;i<num;i++){\r\n                this.createEffect()\r\n            }\r\n        }\r\n\r\n        //遍历子节点，如果出界则销毁\r\n        for(var i=0;i<this.effects.length;i++){\r\n            if(this.effects[i].isValid){\r\n                if(this.effects[i].y<this.camera.y-this.camera.parent.height/2){\r\n                    this.effects[i].destroy()\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    \r\n\r\n    \r\n});\r\n\r\nmodule.exports = {\r\n    getRandomNum:function() {\r\n        //生成[0,5)的随机整数\r\n        var randNum = parseInt(Math.random()*5);\r\n        return randNum;\r\n    },\r\n    getItem:function(randomNum) {\r\n        switch(randomNum) {\r\n            //没有东西\r\n            case 0:\r\n                return null;\r\n            //变大\r\n            case 1:\r\n                return 'star_big';\r\n            //变小\r\n            case 2:\r\n                return 'star_small';\r\n            //画辅助线\r\n            case 3:\r\n                return 'pen';\r\n            //跳高\r\n            case 4:\r\n                return 'jump';\r\n        }\r\n    }\r\n};\r\n"]}