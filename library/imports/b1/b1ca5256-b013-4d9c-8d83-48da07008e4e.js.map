{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\diabolo.js"],"names":["cc","Class","extends","Component","properties","y","isFly","rigidbody","mouseJoint","ropes","default","type","Node","rope","physicsBoxCollider","leftNode","rightNode","leftJoint","onLoad","node","on","EventType","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","TOUCH_CANCEL","getComponent","RigidBody","ropeList","children","getChildByName","DistanceJoint","rightJoint","MouseJoint","PhysicsBoxCollider","camera","find","log","scale","start","enabled","touchBegin","event","console","info","calV2","k","leftnode_wp","convertToWorldSpaceAR","v2","rightnode_wp","diabolo_wp","f1","sub","f2","result_v2","add","linearVelocity","cancelLRJoint","destroy","connectedBody","apply","update","dt","isValid","parent","height"],"mappings":"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","file":"diabolo.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        y:0,\n        isFly:false,//是否正在飞行中\n        rigidbody:null,//刚体\n        mouseJoint:null,\n        ropes:{\n            default:null,\n            type:cc.Node\n        },//关联rope的父节点，可以通过这个父节点访问子节点\n        rope:null,//空竹所在的绳子\n        physicsBoxCollider:null,//物理墙\n        leftNode:null,//左连接点\n        rightNode:null,//右连接点\n        leftJoint:null,//左distanceJoint组件\n        leftJoint:null,//右distanceJoint组件\n        camera:null,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        //注册Touch事件\n        // this.node.on(cc.Node.EventType.TOUCH_START,this.touchBegin,this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE,this.touchMove,this);\n        this.node.on(cc.Node.EventType.TOUCH_END,this.touchEnd,this);//当手指在目标节点区域内离开屏幕时\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.touchEnd,this);//当手指在目标节点区域外离开屏幕时\n\n        //绑定刚体\n        this.rigidbody = this.node.getComponent(cc.RigidBody);\n        //绑定左右连接点\n        var ropeList=this.ropes.children;\n        this.rope=ropeList[0]\n        this.leftNode=this.rope.getChildByName(\"left\")\n        this.rightNode=this.rope.getChildByName(\"right\")\n        //绑定左右distanceJoint组件\n        this.leftJoint=this.leftNode.getComponent(cc.DistanceJoint)\n        this.rightJoint=this.rightNode.getComponent(cc.DistanceJoint)\n        // this.leftJoint.connectedBody=this.rigidbody\n        // this.rightJoint.connectedBody=this.rigidbody\n        //绑定mouseJoint\n        this.mouseJoint=this.node.getComponent(cc.MouseJoint)\n        //绑定物理碰撞\n        this.physicsBoxCollider=this.rope.getComponent(cc.PhysicsBoxCollider)\n        //如果在绳子上，则空竹y等于绳子的y\n        this.y=this.rope.y\n        //\n        this.camera=cc.find(\"Canvas/Main Camera\")\n        cc.log(this.rope)\n        cc.log(this.physicsBoxCollider)\n        cc.log(\"scale:\"+this.node.scale)\n    },\n\n    start () {\n        this.physicsBoxCollider.enabled=true\n    },\n\n    touchBegin:function(event){\n        console.info(\"begin\")\n       \n    },\n\n    touchMove:function(event){\n        console.info(\"move\")\n        //如果空竹比绳子高，则不能往上拉动\n    },\n\n    /**\n     * 放手后，与当前左右连接点解绑\n     * 空竹沿着两边固定点的中心方向射出\n     * 初速度与拉伸程度有关\n     * @param {*} event \n     */\n\n    //计算速度向量\n    calV2:function(){\n        // var biabolo_v2=this.rigidbody.getWorldVector();\n        // var rope_v2=this.rope.getWorldVector();\n        var k=5.5//系数，可调\n        // var f1=this.leftJoint.getReactionForce(1)//获取反作用力\n        // var f2=this.rightJoint.getReactionForce(1)\n        var leftnode_wp=this.leftNode.convertToWorldSpaceAR(cc.v2(0,0))//左节点的世界坐标向量\n        var rightnode_wp=this.rightNode.convertToWorldSpaceAR(cc.v2(0,0))\n        var diabolo_wp=this.node.convertToWorldSpaceAR(cc.v2(0,0))\n        var f1=leftnode_wp.sub(diabolo_wp)//左上拉力向量\n        var f2=rightnode_wp.sub(diabolo_wp)\n        var result_v2=f1.add(f2)\n        result_v2=result_v2.scale(cc.v2(k,k))//乘一个系数，放大作用力\n        cc.log(f1)\n        cc.log(f2)\n        cc.log(result_v2)\n        return result_v2\n    },\n\n    touchEnd:function(event){\n        console.info(\"end\")\n\n        if(!this.isFly){\n            //给个初速度向量，相当于射出去\n            this.rigidbody.linearVelocity=this.calV2()\n            //删除两端连接点\n            this.cancelLRJoint()\n            //删除拉动点mouseJoint\n            this.mouseJoint.destroy()\n            this.mouseJoint=null\n            //设置为飞行状态\n            this.isFly=true\n            //开门\n            this.physicsBoxCollider.enabled=false\n        }\n        // this.bandMouseJoint()\n        // cc.log(this.mouseJoint)\n    },\n\n    //取消左右节点绑定\n    cancelLRJoint:function(){\n        // this.rope=null\n        this.leftJoint.enabled=false\n        this.leftJoint.connectedBody=null\n        this.rightJoint.enabled=false\n        this.rightJoint.connectedBody=null\n        this.leftJoint.apply()\n        this.rightJoint.apply()\n    },\n\n    \n\n    update (dt) {\n        //如果正在飞行，则y等于节点的y\n        if(this.isFly){\n            this.y=this.node.y\n        }else{\n            this.y=this.rope.y\n        }\n\n        if(this.node.isValid){\n            if(this.node.y<this.camera.y-this.camera.parent.height/2){\n                this.node.destroy()\n            }\n        }\n        \n    },\n});\n"]}