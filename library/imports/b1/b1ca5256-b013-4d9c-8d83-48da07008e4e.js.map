{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\diabolo.js"],"names":["cc","Class","extends","Component","properties","y","isFly","rigidbody","mouseJoint","ropes","default","type","Node","rope","physicsBoxCollider","leftNode","rightNode","leftJoint","onLoad","node","on","EventType","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","TOUCH_CANCEL","getComponent","RigidBody","ropeList","children","getChildByName","DistanceJoint","rightJoint","MouseJoint","PhysicsBoxCollider","camera","find","log","scale","start","connectedBody","enabled","touchBegin","event","console","info","calV2","k","leftnode_wp","convertToWorldSpaceAR","v2","rightnode_wp","diabolo_wp","f1","sub","f2","result_v2","add","linearVelocity","cancelLRJoint","destroy","apply","update","dt","isValid","parent","height"],"mappings":"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","file":"diabolo.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        y:0,\r\n        isFly:false,//是否正在飞行中\r\n        rigidbody:null,//刚体\r\n        mouseJoint:null,\r\n        ropes:{\r\n            default:null,\r\n            type:cc.Node\r\n        },//关联rope的父节点，可以通过这个父节点访问子节点\r\n        rope:null,//空竹所在的绳子\r\n        physicsBoxCollider:null,//物理墙\r\n        leftNode:null,//左连接点\r\n        rightNode:null,//右连接点\r\n        leftJoint:null,//左distanceJoint组件\r\n        leftJoint:null,//右distanceJoint组件\r\n        camera:null,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        //注册Touch事件\r\n        // this.node.on(cc.Node.EventType.TOUCH_START,this.touchBegin,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE,this.touchMove,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END,this.touchEnd,this);//当手指在目标节点区域内离开屏幕时\r\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.touchEnd,this);//当手指在目标节点区域外离开屏幕时\r\n\r\n        //绑定刚体\r\n        this.rigidbody = this.node.getComponent(cc.RigidBody);\r\n        //绑定左右连接点\r\n        var ropeList=this.ropes.children;\r\n        this.rope=ropeList[0]\r\n        this.leftNode=this.rope.getChildByName(\"left\")\r\n        this.rightNode=this.rope.getChildByName(\"right\")\r\n        //绑定左右distanceJoint组件\r\n        this.leftJoint=this.leftNode.getComponent(cc.DistanceJoint)\r\n        this.rightJoint=this.rightNode.getComponent(cc.DistanceJoint)\r\n       \r\n        //绑定mouseJoint\r\n        this.mouseJoint=this.node.getComponent(cc.MouseJoint)\r\n        //绑定物理碰撞\r\n        this.physicsBoxCollider=this.rope.getComponent(cc.PhysicsBoxCollider)\r\n        //如果在绳子上，则空竹y等于绳子的y\r\n        this.y=this.rope.y\r\n        //\r\n        this.camera=cc.find(\"Canvas/Main Camera\")\r\n        cc.log(this.rope)\r\n        cc.log(this.physicsBoxCollider)\r\n        cc.log(\"scale:\"+this.node.scale)\r\n    },\r\n\r\n    start () {\r\n        this.leftJoint.connectedBody=this.rigidbody\r\n        this.rightJoint.connectedBody=this.rigidbody\r\n        this.physicsBoxCollider.enabled=true\r\n    },\r\n\r\n    touchBegin:function(event){\r\n        console.info(\"begin\")\r\n       \r\n    },\r\n\r\n    touchMove:function(event){\r\n        console.info(\"move\")\r\n        //如果空竹比绳子高，则不能往上拉动\r\n    },\r\n\r\n    /**\r\n     * 放手后，与当前左右连接点解绑\r\n     * 空竹沿着两边固定点的中心方向射出\r\n     * 初速度与拉伸程度有关\r\n     * @param {*} event \r\n     */\r\n\r\n    //计算速度向量\r\n    calV2:function(){\r\n        // var biabolo_v2=this.rigidbody.getWorldVector();\r\n        // var rope_v2=this.rope.getWorldVector();\r\n        var k=5.5//系数，可调\r\n        // var f1=this.leftJoint.getReactionForce(1)//获取反作用力\r\n        // var f2=this.rightJoint.getReactionForce(1)\r\n        var leftnode_wp=this.leftNode.convertToWorldSpaceAR(cc.v2(0,0))//左节点的世界坐标向量\r\n        var rightnode_wp=this.rightNode.convertToWorldSpaceAR(cc.v2(0,0))\r\n        var diabolo_wp=this.node.convertToWorldSpaceAR(cc.v2(0,0))\r\n        var f1=leftnode_wp.sub(diabolo_wp)//左上拉力向量\r\n        var f2=rightnode_wp.sub(diabolo_wp)\r\n        var result_v2=f1.add(f2)\r\n        result_v2=result_v2.scale(cc.v2(k,k))//乘一个系数，放大作用力\r\n        cc.log(f1)\r\n        cc.log(f2)\r\n        cc.log(result_v2)\r\n        return result_v2\r\n    },\r\n\r\n    touchEnd:function(event){\r\n        console.info(\"end\")\r\n\r\n        if(!this.isFly){\r\n            //给个初速度向量，相当于射出去\r\n            this.rigidbody.linearVelocity=this.calV2()\r\n            //删除两端连接点\r\n            this.cancelLRJoint()\r\n            //删除拉动点mouseJoint\r\n            this.mouseJoint.destroy()\r\n            this.mouseJoint=null\r\n            //设置为飞行状态\r\n            this.isFly=true\r\n            //开门\r\n            this.physicsBoxCollider.enabled=false\r\n        }\r\n        // this.bandMouseJoint()\r\n        // cc.log(this.mouseJoint)\r\n    },\r\n\r\n    //取消左右节点绑定\r\n    cancelLRJoint:function(){\r\n        // this.rope=null\r\n        this.leftJoint.enabled=false\r\n        this.leftJoint.connectedBody=null\r\n        this.rightJoint.enabled=false\r\n        this.rightJoint.connectedBody=null\r\n        this.leftJoint.apply()\r\n        this.rightJoint.apply()\r\n    },\r\n\r\n    \r\n\r\n    update (dt) {\r\n        //如果正在飞行，则y等于节点的y\r\n        if(this.isFly){\r\n            this.y=this.node.y\r\n        }else{\r\n            if(this.rope.isValid){\r\n                this.y=this.rope.y\r\n            } else{//如果所在的绳子消失\r\n                if(this.mouseJoint!=null){\r\n                    this.mouseJoint.destroy()//取消拉动\r\n                    this.mouseJoint=null\r\n                    //设置为飞行状态\r\n                    this.isFly=true\r\n                }\r\n            }\r\n        }\r\n\r\n        if(this.node.isValid){\r\n            if(this.node.y<this.camera.y-this.camera.parent.height/2){\r\n                this.node.destroy()\r\n            }\r\n        }\r\n        \r\n    },\r\n});\r\n"]}