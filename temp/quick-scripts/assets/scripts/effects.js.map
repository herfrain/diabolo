{"version":3,"sources":["effects.js"],"names":["random","require","cc","Class","extends","Component","properties","effects","camera","ropes","ropesNode","onLoad","find","getRandomNum","randNum","parseInt","Math","getItem","randomNum","createEffect","length","effectsNode","node","item","randRope","getRndIntegerUp","ropeX","x","ropeY","y","loader","loadRes","err","prefab","newNode","instantiate","addChild","start","children","schedule","update","dt","i","isValid","parent","height","destroy"],"mappings":"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","file":"effects.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nvar random=require('random')\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        effects:null,\r\n        camera:null,\r\n        ropes:null,\r\n        ropesNode:null,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.camera=cc.find(\"Canvas/Main Camera\")\r\n        this.ropesNode=cc.find(\"Canvas/ropes\")\r\n    },\r\n\r\n    getRandomNum:function() {\r\n        //生成[0,5)的随机整数\r\n        var randNum = parseInt(Math.random()*5)+1;\r\n        return randNum;\r\n    },\r\n\r\n    getItem:function(randomNum) {\r\n        switch(randomNum) {\r\n            //没有东西\r\n            case 0:\r\n                return null;\r\n            //变大\r\n            case 1:\r\n                return 'star_big';\r\n            //变小\r\n            case 2:\r\n                return 'star_small';\r\n            //画辅助线\r\n            // case 3:\r\n            //     return 'pen';\r\n            //跳高\r\n            case 3:\r\n                return 'jump';\r\n            //上树\r\n            case 4:\r\n                return 'fly';\r\n            case 5:\r\n                return 'lantern_scoreUp'\r\n        }\r\n    },\r\n\r\n    createEffect:function(){\r\n        if(this.effects.length>6){\r\n            return\r\n        }\r\n        var effectsNode=this.node\r\n        var randNum = this.getRandomNum();\r\n        //获得本次随机生成的道具\r\n        var item = this.getItem(randNum);\r\n        //随机某一根绳子\r\n        var randRope = 0\r\n        if(this.ropes.length-5>=0)\r\n            randRope = random.getRndIntegerUp(this.ropes.length-5,this.ropes.length-1);\r\n        //该绳子位置\r\n        var ropeX = this.ropes[randRope].x;\r\n        var ropeY = this.ropes[randRope].y;\r\n        //加载道具\r\n        cc.loader.loadRes(item, function(err, prefab) {\r\n            var newNode = cc.instantiate(prefab);\r\n            // console.log(\"生成道具\");\r\n            // newNode.parent = effectsNode;//不知道为何，有时会是null？？？\r\n            // cc.log(ropeX)\r\n            newNode.x = ropeX+random.getRndIntegerUp(-80,80);\r\n            newNode.y = ropeY+random.getRndIntegerUp(-200,200);\r\n            effectsNode.addChild(newNode)\r\n            // cc.log(\"道具数量：\"+effectsNode.children.length)\r\n        });\r\n    },\r\n\r\n    start () {\r\n        this.effects=this.node.children\r\n        this.ropes=this.ropesNode.children\r\n        this.schedule(this.createEffect, (Math.random()*10)+10 );\r\n    },\r\n\r\n    update (dt) {\r\n        // cc.log(this.effects.length)\r\n        // cc.log(this.camera.y+this.camera.parent.height>this.ropes[this.ropes.length-1].y)\r\n        // if(this.camera.y+this.camera.parent.height>this.ropes[this.ropes.length-1].y){\r\n        //     var num=random.getRndIntegerUp(0,2)\r\n        //     for(var i=0;i<num;i++){\r\n        //         cc.log(\"lll\")\r\n        //         this.createEffect()\r\n        //     }\r\n        // }\r\n\r\n        //遍历子节点，如果出界则销毁\r\n        for(var i=0;i<this.effects.length;i++){\r\n            if(this.effects[i].isValid){\r\n                if(this.effects[i].y<this.camera.y-this.camera.parent.height/2){\r\n                    this.effects[i].destroy()\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    \r\n\r\n    \r\n});"]}