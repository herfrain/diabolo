{"version":3,"sources":["ropes.js"],"names":["effects","require","random","cc","Class","extends","Component","properties","ropes","diabolo","diaboloComponent","camera","default","type","Node","effectsNode","onLoad","find","getComponent","ropeList","node","children","firstrope","prerope","i","nextrope","instantiate","y","getRndIntegerUp","x","parent","width","addChild","leftNode","getChildByName","rightNode","leftJoint","DistanceJoint","rightJoint","connectedBody","rigidbody","log","start","console","length","timeCallback","randNum","getRandomNum","item","getItem","randRope","ropeX","ropeY","loader","loadRes","err","prefab","newNode","schedule","Math","update","dt","height","isValid","destroy"],"mappings":"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","file":"ropes.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\n\r\nvar effects = require(\"effects\")\r\n\r\n//ropes 绳子组\r\n//功能：自动随机生成下一跳的绳子\r\nvar random=require('random')\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        ropes:null,\r\n        diabolo:null,\r\n        diaboloComponent:null,\r\n        camera:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        effectsNode:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n    },\r\n\r\n    // // LIFE-CYCLE CALLBACKS:\r\n    // getRndInteger:function(min, max) {\r\n    //     if(Math.random()<0.5){//左边\r\n    //         return Math.floor(Math.random() * (-this.m - min + 1) ) + min;\r\n    //     }else{\r\n    //         return Math.floor(Math.random() * (max - this.m + 1) ) + this.m;\r\n    //     }\r\n    // },\r\n\r\n    // getRndIntegerUp:function(min, max) {\r\n    //     return Math.floor(Math.random() * (max - min + 1) ) + min;\r\n    // },\r\n\r\n    onLoad () {\r\n        // this.enabled=false\r\n        this.diabolo=cc.find(\"Canvas/diabolo\")\r\n        this.diaboloComponent=this.diabolo.getComponent(\"diabolo\")\r\n        var ropeList=this.node.children\r\n        var firstrope=ropeList[0]\r\n        var prerope=firstrope\r\n        for(var i=0;i<10;i++){\r\n            var nextrope=cc.instantiate(prerope)\r\n            // cc.log(random.getRndIntegerUp(-300,300))\r\n            nextrope.y=prerope.y+random.getRndIntegerUp(100,200)\r\n            nextrope.x=random.getRndIntegerUp(-this.camera.parent.width/2+100,this.camera.parent.width/2-100)\r\n            // cc.log(\"prerope:\"+prerope.x)\r\n            prerope=nextrope\r\n            this.node.addChild(nextrope)\r\n        }\r\n        var leftNode=firstrope.getChildByName(\"left\")\r\n        var rightNode=firstrope.getChildByName(\"right\")\r\n        //绑定左右distanceJoint组件\r\n        var leftJoint=leftNode.getComponent(cc.DistanceJoint)\r\n        var rightJoint=rightNode.getComponent(cc.DistanceJoint)\r\n        leftJoint.connectedBody=this.diaboloComponent.rigidbody\r\n        rightJoint.connectedBody=this.diaboloComponent.rigidbody\r\n        cc.log(firstrope)\r\n    },\r\n\r\n    start () {\r\n        var effectsNode=this.effectsNode//effects节点\r\n        this.ropes=this.node.children\r\n        console.log(this.ropes.length);\r\n        // var ropes = this.ropes;\r\n        // cc.log(ropes)\r\n        var timeCallback = function () {\r\n            // cc.log(this.ropes)\r\n            var randNum = effects.getRandomNum();\r\n            //获得本次随机生成的道具\r\n            var item = effects.getItem(randNum);\r\n            //随机某一根绳子\r\n            var randRope = 0\r\n            if(this.ropes.length-5>=0)\r\n                randRope = random.getRndIntegerUp(this.ropes.length-5,this.ropes.length-1);\r\n            //该绳子位置\r\n            var ropeX = this.ropes[randRope].x;\r\n            var ropeY = this.ropes[randRope].y;\r\n            //加载道具\r\n            cc.loader.loadRes(item, function(err, prefab) {\r\n                var newNode = cc.instantiate(prefab);\r\n                console.log(\"生成道具\");\r\n                newNode.parent = effectsNode;//不知道为何，有时会是null？？？\r\n                newNode.x = ropeX+random.getRndIntegerUp(-80,80);\r\n                newNode.y = ropeY+random.getRndIntegerUp(-200,200);\r\n                cc.log(\"道具数量：\"+effectsNode.children.length)\r\n            });\r\n        }\r\n        //if(random.newRndItem) {\r\n        this.schedule(timeCallback, (Math.random()*10)+10 );\r\n    },\r\n\r\n    update (dt) {\r\n        //在摄像机顶部添加绳子\r\n        // if(Math.abs(this.camera.y)%200==0)\r\n        // if(this.camera.y+this.camera.parent.height>this.ropes[this.ropes.length-1].y)\r\n        if(this.camera.y+this.camera.parent.height>this.ropes[this.ropes.length-1].y){\r\n            cc.log(\"create rope\")\r\n            var prerope=this.ropes[this.ropes.length-1]\r\n            for(var i=0;i<10;i++){\r\n                var nextrope=cc.instantiate(prerope)\r\n                // cc.log(random.getRndIntegerUp(-300,300))\r\n                nextrope.y=prerope.y+random.getRndIntegerUp(100,200)\r\n                nextrope.x=random.getRndIntegerUp(-this.camera.parent.width/2+100,this.camera.parent.width/2-100)\r\n                // cc.log(\"prerope:\"+prerope.x)\r\n                prerope=nextrope\r\n                this.node.addChild(nextrope)\r\n            }\r\n            // //加载prefab预制资源\r\n            // cc.loader.loadRes('rope.prefab', (err, resource)=>{\r\n            //     if(err){ return; }\r\n            //     // var rope=cc.instantiate(resource)//克隆实例\r\n            //     // rope.y=this.camera.y+this.camera.parent.height/2+random.getRndIntegerUp(0,50)//从摄像机顶部开始\r\n            //     // rope.x=random.getRndIntegerUp(-this.camera.parent.width/2+100,this.camera.parent.width/2-100)\r\n            //     // this.node.addChild(rope)//添加绳子\r\n                \r\n            // });\r\n        }\r\n        // cc.log(this.ropes.length)\r\n        for(var i=0;i<this.ropes.length;i++){\r\n            if(this.ropes[i].isValid){\r\n                if(this.ropes[i].y<this.camera.y-this.camera.parent.height/2){//低于摄像机下边界\r\n                    // cc.log(2)\r\n                    this.ropes[i].destroy()\r\n                }\r\n            }\r\n        }\r\n    },\r\n});\r\n"]}