{"version":3,"sources":["ropes.js"],"names":["random","require","cc","Class","extends","Component","properties","ropes","diabolo","diaboloComponent","camera","default","type","Node","onLoad","find","getComponent","ropeList","node","children","firstrope","prerope","i","nextrope","instantiate","y","getRndIntegerUp","x","parent","width","addChild","leftNode","getChildByName","rightNode","leftJoint","DistanceJoint","rightJoint","connectedBody","rigidbody","log","start","update","dt","height","length","loader","loadRes","err","resource","isValid","destroy"],"mappings":"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","file":"ropes.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\n\r\n//ropes 绳子组\r\n//功能：自动随机生成下一跳的绳子\r\nvar random=require('random')\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        ropes:null,\r\n        diabolo:null,\r\n        diaboloComponent:null,\r\n        camera:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n    },\r\n\r\n    // // LIFE-CYCLE CALLBACKS:\r\n    // getRndInteger:function(min, max) {\r\n    //     if(Math.random()<0.5){//左边\r\n    //         return Math.floor(Math.random() * (-this.m - min + 1) ) + min;\r\n    //     }else{\r\n    //         return Math.floor(Math.random() * (max - this.m + 1) ) + this.m;\r\n    //     }\r\n    // },\r\n\r\n    // getRndIntegerUp:function(min, max) {\r\n    //     return Math.floor(Math.random() * (max - min + 1) ) + min;\r\n    // },\r\n\r\n    onLoad () {\r\n        // this.enabled=false\r\n        this.diabolo=cc.find(\"Canvas/diabolo\")\r\n        this.diaboloComponent=this.diabolo.getComponent(\"diabolo\")\r\n        var ropeList=this.node.children\r\n        var firstrope=ropeList[0]\r\n        var prerope=firstrope\r\n        for(var i=0;i<10;i++){\r\n            var nextrope=cc.instantiate(prerope)\r\n            // cc.log(random.getRndIntegerUp(-300,300))\r\n            nextrope.y=prerope.y+random.getRndIntegerUp(100,200)\r\n            nextrope.x=random.getRndIntegerUp(-this.camera.parent.width/2+100,this.camera.parent.width/2-100)\r\n            // cc.log(\"prerope:\"+prerope.x)\r\n            prerope=nextrope\r\n            this.node.addChild(nextrope)\r\n        }\r\n        var leftNode=firstrope.getChildByName(\"left\")\r\n        var rightNode=firstrope.getChildByName(\"right\")\r\n        //绑定左右distanceJoint组件\r\n        var leftJoint=leftNode.getComponent(cc.DistanceJoint)\r\n        var rightJoint=rightNode.getComponent(cc.DistanceJoint)\r\n        leftJoint.connectedBody=this.diaboloComponent.rigidbody\r\n        rightJoint.connectedBody=this.diaboloComponent.rigidbody\r\n        cc.log(firstrope)\r\n    },\r\n\r\n    start () {\r\n        this.ropes=this.node.children\r\n    },\r\n\r\n    update (dt) {\r\n        //在摄像机顶部添加绳子\r\n        // if(Math.abs(this.camera.y)%200==0)\r\n        // if(this.camera.y+this.camera.parent.height>this.ropes[this.ropes.length-1].y)\r\n        if(this.camera.y+this.camera.parent.height>this.ropes[this.ropes.length-1].y){\r\n            //加载prefab预制资源\r\n            cc.loader.loadRes('rope.prefab', (err, resource)=>{\r\n                if(err){ return; }\r\n                // var rope=cc.instantiate(resource)//克隆实例\r\n                // rope.y=this.camera.y+this.camera.parent.height/2+random.getRndIntegerUp(0,50)//从摄像机顶部开始\r\n                // rope.x=random.getRndIntegerUp(-this.camera.parent.width/2+100,this.camera.parent.width/2-100)\r\n                // this.node.addChild(rope)//添加绳子\r\n                var prerope=this.ropes[this.ropes.length-1]\r\n                for(var i=0;i<10;i++){\r\n                    var nextrope=cc.instantiate(prerope)\r\n                    // cc.log(random.getRndIntegerUp(-300,300))\r\n                    nextrope.y=prerope.y+random.getRndIntegerUp(100,200)\r\n                    nextrope.x=random.getRndIntegerUp(-this.camera.parent.width/2+100,this.camera.parent.width/2-100)\r\n                    // cc.log(\"prerope:\"+prerope.x)\r\n                    prerope=nextrope\r\n                    this.node.addChild(nextrope)\r\n                }\r\n            });\r\n        }\r\n        // cc.log(this.ropes.length)\r\n        for(var i=0;i<this.ropes.length;i++){\r\n            if(this.ropes[i].isValid){\r\n                if(this.ropes[i].y<this.camera.y-this.camera.parent.height/2){//低于摄像机下边界\r\n                    // cc.log(2)\r\n                    this.ropes[i].destroy()\r\n                }\r\n            }\r\n        }\r\n    },\r\n});\r\n"]}