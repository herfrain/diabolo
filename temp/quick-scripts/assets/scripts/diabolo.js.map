{"version":3,"sources":["diabolo.js"],"names":["cc","Class","extends","Component","properties","x","y","x_speed","y_speed","isFly","rigidbody","mouseJoint","ropes","default","type","Node","rope","physicsBoxCollider","leftNode","rightNode","leftJoint","onLoad","node","on","EventType","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","TOUCH_CANCEL","getComponent","RigidBody","ropeList","children","getChildByName","DistanceJoint","rightJoint","MouseJoint","PhysicsBoxCollider","enabled","camera","find","log","touchBegin","event","console","info","calV2","k","leftnode_wp","convertToWorldSpaceAR","v2","rightnode_wp","diabolo_wp","f1","sub","f2","result_v2","add","scale","linearVelocity","cancelLRJoint","destroy","connectedBody","apply","bandLRJoint","other","bandMouseJoint","addComponent","start","onCollisionEnter","self","onCollisionExit","update","dt","isValid","parent","height"],"mappings":"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","file":"diabolo.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        x:0,//x坐标\r\n        y:0,//y坐标\r\n        x_speed:0,//x轴方向速度\r\n        y_speed:0,//y轴方向速度\r\n        isFly:false,//是否正在飞行中\r\n        rigidbody:null,//刚体\r\n        mouseJoint:null,\r\n        ropes:{\r\n            default:null,\r\n            type:cc.Node\r\n        },//关联rope的父节点，可以通过这个父节点访问子节点\r\n        rope:null,//空竹所在的绳子\r\n        physicsBoxCollider:null,//物理墙\r\n        leftNode:null,//左连接点\r\n        rightNode:null,//右连接点\r\n        leftJoint:null,//左distanceJoint组件\r\n        leftJoint:null,//右distanceJoint组件\r\n        camera:null,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        //注册Touch事件\r\n        // this.node.on(cc.Node.EventType.TOUCH_START,this.touchBegin,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE,this.touchMove,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END,this.touchEnd,this);//当手指在目标节点区域内离开屏幕时\r\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.touchEnd,this);//当手指在目标节点区域外离开屏幕时\r\n\r\n        //绑定刚体\r\n        this.rigidbody = this.node.getComponent(cc.RigidBody);\r\n        //绑定左右连接点\r\n        var ropeList=this.ropes.children;\r\n        this.rope=ropeList[0]\r\n        this.leftNode=this.rope.getChildByName(\"left\")\r\n        this.rightNode=this.rope.getChildByName(\"right\")\r\n        //绑定左右distanceJoint组件\r\n        this.leftJoint=this.leftNode.getComponent(cc.DistanceJoint)\r\n        this.rightJoint=this.rightNode.getComponent(cc.DistanceJoint)\r\n        // this.leftJoint.connectedBody=this.rigidbody\r\n        // this.rightJoint.connectedBody=this.rigidbody\r\n        //绑定mouseJoint\r\n        this.mouseJoint=this.node.getComponent(cc.MouseJoint)\r\n        //绑定物理碰撞\r\n        this.physicsBoxCollider=this.rope.getComponent(cc.PhysicsBoxCollider)\r\n        this.physicsBoxCollider.enabled=true\r\n        //\r\n        this.camera=cc.find(\"Canvas/Main Camera\")\r\n        cc.log(this.rope)\r\n        cc.log(this.physicsBoxCollider)\r\n    },\r\n\r\n    touchBegin:function(event){\r\n        console.info(\"begin\")\r\n       \r\n    },\r\n\r\n    touchMove:function(event){\r\n        console.info(\"move\")\r\n        //如果空竹比绳子高，则不能往上拉动\r\n    },\r\n\r\n    /**\r\n     * 放手后，与当前左右连接点解绑\r\n     * 空竹沿着两边固定点的中心方向射出\r\n     * 初速度与拉伸程度有关\r\n     * @param {*} event \r\n     */\r\n\r\n    //计算速度向量\r\n    calV2:function(){\r\n        // var biabolo_v2=this.rigidbody.getWorldVector();\r\n        // var rope_v2=this.rope.getWorldVector();\r\n        var k=5.5//系数，可调\r\n        // var f1=this.leftJoint.getReactionForce(1)//获取反作用力\r\n        // var f2=this.rightJoint.getReactionForce(1)\r\n        var leftnode_wp=this.leftNode.convertToWorldSpaceAR(cc.v2(0,0))//左节点的世界坐标向量\r\n        var rightnode_wp=this.rightNode.convertToWorldSpaceAR(cc.v2(0,0))\r\n        var diabolo_wp=this.node.convertToWorldSpaceAR(cc.v2(0,0))\r\n        var f1=leftnode_wp.sub(diabolo_wp)//左上拉力向量\r\n        var f2=rightnode_wp.sub(diabolo_wp)\r\n        var result_v2=f1.add(f2)\r\n        result_v2=result_v2.scale(cc.v2(k,k))//乘一个系数，放大作用力\r\n        cc.log(f1)\r\n        cc.log(f2)\r\n        cc.log(result_v2)\r\n        return result_v2\r\n    },\r\n\r\n    touchEnd:function(event){\r\n        console.info(\"end\")\r\n\r\n        if(!this.isFly){\r\n            //给个初速度向量，相当于射出去\r\n            this.rigidbody.linearVelocity=this.calV2()\r\n            //删除两端连接点\r\n            this.cancelLRJoint()\r\n            //删除拉动点mouseJoint\r\n            this.mouseJoint.destroy()\r\n            this.mouseJoint=null\r\n            //设置为飞行状态\r\n            this.isFly=true\r\n            //开门\r\n            this.physicsBoxCollider.enabled=false\r\n        }\r\n        // this.bandMouseJoint()\r\n        // cc.log(this.mouseJoint)\r\n    },\r\n\r\n    //取消左右节点绑定\r\n    cancelLRJoint:function(){\r\n        this.leftJoint.enabled=false\r\n        this.leftJoint.connectedBody=null\r\n        this.rightJoint.enabled=false\r\n        this.rightJoint.connectedBody=null\r\n        this.leftJoint.apply()\r\n        this.rightJoint.apply()\r\n    },\r\n\r\n    //绑定左右节点\r\n    bandLRJoint:function(other){\r\n        //绑定左右连接点\r\n        this.rope=other.node\r\n        this.leftNode=this.rope.getChildByName(\"left\")\r\n        this.rightNode=this.rope.getChildByName(\"right\")\r\n        //绑定左右distanceJoint组件\r\n        this.leftJoint=this.leftNode.getComponent(cc.DistanceJoint)\r\n        this.rightJoint=this.rightNode.getComponent(cc.DistanceJoint)\r\n        this.leftJoint.connectedBody=this.rigidbody\r\n        this.rightJoint.connectedBody=this.rigidbody\r\n        this.leftJoint.enabled=true\r\n        this.rightJoint.enabled=true\r\n        this.leftJoint.apply()//修改之后需要apply()才能真正设置完成\r\n        this.rightJoint.apply()\r\n    },\r\n\r\n\r\n    //重新绑定mousejoint\r\n    bandMouseJoint:function(){\r\n        this.node.addComponent(cc.MouseJoint)//添加组件\r\n        this.mouseJoint=this.node.getComponent(cc.MouseJoint)\r\n    },\r\n\r\n\r\n    start () {\r\n        \r\n    },\r\n\r\n    onCollisionEnter:function(other,self){\r\n        cc.log('enter')\r\n    },\r\n\r\n    //如果检测到与绳子发生碰撞，则建立两边点的链接，并将绑定mousejoint，飞行状态设为false\r\n    //结束碰撞时，如果空竹是往下落的，则添加绳子\r\n    onCollisionExit: function (other, self) {\r\n        console.log('on collision enter');\r\n        if(this.rigidbody.linearVelocity.y<0){\r\n            //绑定左右节点\r\n            this.bandLRJoint(other)\r\n            cc.log(this.rope)\r\n            cc.log(this.leftJoint)\r\n            //绑定mouseJoint\r\n            this.bandMouseJoint()\r\n            // other.enabled=false\r\n            this.isFly=false//固定在绳子上\r\n            //关门\r\n            this.physicsBoxCollider=this.rope.getComponent(cc.PhysicsBoxCollider)\r\n            this.physicsBoxCollider.enabled=true\r\n        }\r\n\r\n\r\n    },\r\n\r\n    update (dt) {\r\n        // cc.log(this.node.convertToWorldSpaceAR(cc.v2(0,0)))\r\n        // if(this.node.convertToWorldSpaceAR(cc.v2(0,0))){\r\n\r\n        // }\r\n        if(this.node.isValid){\r\n            if(this.node.y<this.camera.y-this.camera.parent.height/2){\r\n                this.node.destroy()\r\n            }\r\n        }\r\n        \r\n    },\r\n});\r\n"]}