{"version":3,"sources":["diabolo.js"],"names":["cc","Class","extends","Component","properties","y","isFly","rigidbody","mouseJoint","ropes","rope","physicsBoxCollider","leftNode","rightNode","leftJoint","default","type","AudioClip","onLoad","node","on","Node","EventType","TOUCH_START","touchBegin","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","TOUCH_CANCEL","getComponent","RigidBody","find","ropeList","children","getChildByName","DistanceJoint","rightJoint","MouseJoint","PhysicsBoxCollider","camera","start","connectedBody","enabled","event","console","info","audioEngine","play","pullAudio","calV2","k","leftnode_wp","convertToWorldSpaceAR","v2","rightnode_wp","diabolo_wp","f1","sub","f2","result_v2","add","scale","linearVelocity","cancelLRJoint","destroy","popupAudio","apply","update","dt","parent","height","isValid","convertToNodeSpaceAR"],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC;AACIC,WAAE,CADN;AAEIC,eAAM,KAFV,EAEgB;AACZC,mBAAU,IAHd,EAGmB;AACfC,oBAAW,IAJf;AAKIC,eAAM,IALV,EAKe;AACXC,cAAK,IANT,EAMc;AACVC,4BAAmB,IAPvB,EAO4B;AACxBC,kBAAS,IARb,EAQkB;AACdC,mBAAU,IATd,EASmB;AACfC,mBAAU,IAVd,8CAWc,IAXd,0CAYW,IAZX,8CAagB;AACRC,iBAAS,IADD;AAERC,cAAMhB,GAAGiB;AAFD,KAbhB,6CAiBe;AACPF,iBAAS,IADF;AAEPC,cAAMhB,GAAGiB;AAFF,KAjBf,eAHK;;AA0BL;;AAEAC,UA5BK,oBA4BK;AACN;AACA,aAAKC,IAAL,CAAUC,EAAV,CAAapB,GAAGqB,IAAH,CAAQC,SAAR,CAAkBC,WAA/B,EAA2C,KAAKC,UAAhD,EAA2D,IAA3D;AACA,aAAKL,IAAL,CAAUC,EAAV,CAAapB,GAAGqB,IAAH,CAAQC,SAAR,CAAkBG,UAA/B,EAA0C,KAAKC,SAA/C,EAAyD,IAAzD;AACA,aAAKP,IAAL,CAAUC,EAAV,CAAapB,GAAGqB,IAAH,CAAQC,SAAR,CAAkBK,SAA/B,EAAyC,KAAKC,QAA9C,EAAuD,IAAvD,EAJM,CAIuD;AAC7D,aAAKT,IAAL,CAAUC,EAAV,CAAapB,GAAGqB,IAAH,CAAQC,SAAR,CAAkBO,YAA/B,EAA4C,KAAKD,QAAjD,EAA0D,IAA1D,EALM,CAK0D;;AAEhE;AACA,aAAKrB,SAAL,GAAiB,KAAKY,IAAL,CAAUW,YAAV,CAAuB9B,GAAG+B,SAA1B,CAAjB;AACA;AACA,aAAKtB,KAAL,GAAWT,GAAGgC,IAAH,CAAQ,cAAR,CAAX;AACA,YAAIC,WAAS,KAAKxB,KAAL,CAAWyB,QAAxB;AACA,aAAKxB,IAAL,GAAUuB,SAAS,CAAT,CAAV;AACA,aAAKrB,QAAL,GAAc,KAAKF,IAAL,CAAUyB,cAAV,CAAyB,MAAzB,CAAd;AACA,aAAKtB,SAAL,GAAe,KAAKH,IAAL,CAAUyB,cAAV,CAAyB,OAAzB,CAAf;AACA;AACA,aAAKrB,SAAL,GAAe,KAAKF,QAAL,CAAckB,YAAd,CAA2B9B,GAAGoC,aAA9B,CAAf;AACA,aAAKC,UAAL,GAAgB,KAAKxB,SAAL,CAAeiB,YAAf,CAA4B9B,GAAGoC,aAA/B,CAAhB;;AAEA;AACA,aAAK5B,UAAL,GAAgB,KAAKW,IAAL,CAAUW,YAAV,CAAuB9B,GAAGsC,UAA1B,CAAhB;AACA;AACA,aAAK3B,kBAAL,GAAwB,KAAKD,IAAL,CAAUoB,YAAV,CAAuB9B,GAAGuC,kBAA1B,CAAxB;AACA;AACA,aAAKlC,CAAL,GAAO,KAAKK,IAAL,CAAUL,CAAjB;AACA;AACA,aAAKmC,MAAL,GAAYxC,GAAGgC,IAAH,CAAQ,oBAAR,CAAZ;AACA;AACA;AACA;AACH,KA1DI;AA4DLS,SA5DK,mBA4DI;AACL,aAAK3B,SAAL,CAAe4B,aAAf,GAA6B,KAAKnC,SAAlC;AACA,aAAK8B,UAAL,CAAgBK,aAAhB,GAA8B,KAAKnC,SAAnC;AACA,aAAKI,kBAAL,CAAwBgC,OAAxB,GAAgC,IAAhC;AACH,KAhEI;;;AAkELnB,gBAAW,oBAASoB,KAAT,EAAe;AACtBC,gBAAQC,IAAR,CAAa,OAAb;AACD;AACH;AACG9C,WAAG+C,WAAH,CAAeC,IAAf,CAAoB,KAAKC,SAAzB,EAAoC,KAApC,EAA0C,CAA1C;AACF,KAvEI;;AAyELvB,eAAU,mBAASkB,KAAT,EAAe;AACrBC,gBAAQC,IAAR,CAAa,MAAb;AACA;AACH,KA5EI;;AA8EL;;;;;;;AAOA;AACAI,WAAM,iBAAU;AACZ;AACA;AACA,YAAIC,IAAE,GAAN,CAHY,CAGH;AACT;AACA;AACA,YAAIC,cAAY,KAAKxC,QAAL,CAAcyC,qBAAd,CAAoCrD,GAAGsD,EAAH,CAAM,CAAN,EAAQ,CAAR,CAApC,CAAhB,CANY,CAMmD;AAC/D,YAAIC,eAAa,KAAK1C,SAAL,CAAewC,qBAAf,CAAqCrD,GAAGsD,EAAH,CAAM,CAAN,EAAQ,CAAR,CAArC,CAAjB;AACA,YAAIE,aAAW,KAAKrC,IAAL,CAAUkC,qBAAV,CAAgCrD,GAAGsD,EAAH,CAAM,CAAN,EAAQ,CAAR,CAAhC,CAAf;AACA,YAAIG,KAAGL,YAAYM,GAAZ,CAAgBF,UAAhB,CAAP,CATY,CASsB;AAClC,YAAIG,KAAGJ,aAAaG,GAAb,CAAiBF,UAAjB,CAAP;AACA,YAAII,YAAUH,GAAGI,GAAH,CAAOF,EAAP,CAAd;AACAC,oBAAUA,UAAUE,KAAV,CAAgB9D,GAAGsD,EAAH,CAAMH,CAAN,EAAQA,CAAR,CAAhB,CAAV,CAZY,CAYyB;AACrC;AACA;AACA;AACA,eAAOS,SAAP;AACH,KAvGI;;AAyGLhC,cAAS,kBAASgB,KAAT,EAAe;AACpBC,gBAAQC,IAAR,CAAa,KAAb;AACA,YAAG,CAAC,KAAKxC,KAAT,EAAe;AACX;AACA,iBAAKC,SAAL,CAAewD,cAAf,GAA8B,KAAKb,KAAL,EAA9B;AACA;AACA,iBAAKc,aAAL;AACA;AACA,iBAAKxD,UAAL,CAAgByD,OAAhB;AACA,iBAAKzD,UAAL,GAAgB,IAAhB;AACA;AACA,iBAAKF,KAAL,GAAW,IAAX;AACA;AACA,iBAAKK,kBAAL,CAAwBgC,OAAxB,GAAgC,KAAhC;AACA;AACA3C,eAAG+C,WAAH,CAAeC,IAAf,CAAoB,KAAKkB,UAAzB,EAAqC,KAArC,EAA2C,CAA3C;AACH;AACD;AACA;AACH,KA5HI;;AA8HL;AACAF,mBAAc,yBAAU;AACpB;AACA,aAAKlD,SAAL,CAAe6B,OAAf,GAAuB,KAAvB;AACA,aAAK7B,SAAL,CAAe4B,aAAf,GAA6B,IAA7B;AACA,aAAKL,UAAL,CAAgBM,OAAhB,GAAwB,KAAxB;AACA,aAAKN,UAAL,CAAgBK,aAAhB,GAA8B,IAA9B;AACA,aAAK5B,SAAL,CAAeqD,KAAf;AACA,aAAK9B,UAAL,CAAgB8B,KAAhB;AACH,KAvII;;AA2ILC,UA3IK,kBA2IGC,EA3IH,EA2IO;AACR;AACA,YAAG,KAAK/D,KAAL,IAAY,KAAKa,IAAL,CAAUd,CAAV,GAAY,KAAKmC,MAAL,CAAYnC,CAAZ,GAAc,KAAKmC,MAAL,CAAY8B,MAAZ,CAAmBC,MAAnB,GAA0B,CAAnE,EAAqE;AACjE,iBAAKlE,CAAL,GAAO,KAAKc,IAAL,CAAUd,CAAjB;AACH,SAFD,MAGK,IAAG,CAAC,KAAKC,KAAT,EAAe;AAChB;AACA,gBAAG,KAAKI,IAAL,IAAW,IAAX,IAAiB,KAAKA,IAAL,CAAU8D,OAA9B,EAAsC;AAClC,qBAAKnE,CAAL,GAAO,KAAKK,IAAL,CAAUL,CAAjB;AACH,aAFD,MAEO,IAAG,CAAC,KAAKK,IAAL,CAAU8D,OAAd,EAAsB;AAAC;AAC1B,oBAAG,KAAKhE,UAAL,IAAiB,IAApB,EAAyB;AACrB,yBAAKA,UAAL,CAAgByD,OAAhB,GADqB,CACI;AACzB,yBAAKzD,UAAL,GAAgB,IAAhB;AACA;AACA,yBAAKF,KAAL,GAAW,IAAX;AACH;AACJ;AACJ;;AAED,YAAG,KAAKa,IAAL,CAAUqD,OAAb,EAAqB;AACjB,gBAAG,KAAKrD,IAAL,CAAUd,CAAV,GAAY,KAAKmC,MAAL,CAAYnC,CAAZ,GAAc,KAAKmC,MAAL,CAAY8B,MAAZ,CAAmBC,MAAnB,GAA0B,CAAxC,GAA0C,EAAzD,EAA4D;AACxD,qBAAKpD,IAAL,CAAU8C,OAAV;AACH;AACJ;AACD;AACA,YAAI,KAAKvD,IAAL,IAAW,IAAZ,IAAoB,KAAKA,IAAL,CAAU8D,OAA9B,IAA0C,KAAK/D,KAAL,CAAWgE,oBAAX,CAAgC,KAAKtD,IAAL,CAAUkC,qBAAV,CAAgCrD,GAAGsD,EAAH,CAAM,CAAN,EAAQ,CAAR,CAAhC,CAAhC,EAA6EjD,CAA7E,GAAgF,KAAKK,IAAL,CAAUL,CAAvI,EAA0I;AACtI;AACA;AACA,iBAAKK,IAAL,GAAY,IAAZ;AACH;AACJ;AAzKI,CAAT","file":"diabolo.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        y:0,\r\n        isFly:false,//是否正在飞行中\r\n        rigidbody:null,//刚体\r\n        mouseJoint:null,\r\n        ropes:null,//关联rope的父节点，可以通过这个父节点访问子节点\r\n        rope:null,//空竹所在的绳子\r\n        physicsBoxCollider:null,//物理墙\r\n        leftNode:null,//左连接点\r\n        rightNode:null,//右连接点\r\n        leftJoint:null,//左distanceJoint组件\r\n        leftJoint:null,//右distanceJoint组件\r\n        camera:null,\r\n        popupAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },//弹出音效\r\n        pullAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },//拉动音效\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        //注册Touch事件\r\n        this.node.on(cc.Node.EventType.TOUCH_START,this.touchBegin,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE,this.touchMove,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END,this.touchEnd,this);//当手指在目标节点区域内离开屏幕时\r\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.touchEnd,this);//当手指在目标节点区域外离开屏幕时\r\n\r\n        //绑定刚体\r\n        this.rigidbody = this.node.getComponent(cc.RigidBody);\r\n        //绑定左右连接点\r\n        this.ropes=cc.find(\"Canvas/ropes\")\r\n        var ropeList=this.ropes.children;\r\n        this.rope=ropeList[0]\r\n        this.leftNode=this.rope.getChildByName(\"left\")\r\n        this.rightNode=this.rope.getChildByName(\"right\")\r\n        //绑定左右distanceJoint组件\r\n        this.leftJoint=this.leftNode.getComponent(cc.DistanceJoint)\r\n        this.rightJoint=this.rightNode.getComponent(cc.DistanceJoint)\r\n       \r\n        //绑定mouseJoint\r\n        this.mouseJoint=this.node.getComponent(cc.MouseJoint)\r\n        //绑定物理碰撞\r\n        this.physicsBoxCollider=this.rope.getComponent(cc.PhysicsBoxCollider)\r\n        //如果在绳子上，则空竹y等于绳子的y\r\n        this.y=this.rope.y\r\n        //\r\n        this.camera=cc.find(\"Canvas/Main Camera\")\r\n        // cc.log(this.rope)\r\n        // cc.log(this.physicsBoxCollider)\r\n        // cc.log(\"scale:\"+this.node.scale)\r\n    },\r\n\r\n    start () {\r\n        this.leftJoint.connectedBody=this.rigidbody\r\n        this.rightJoint.connectedBody=this.rigidbody\r\n        this.physicsBoxCollider.enabled=true\r\n    },\r\n\r\n    touchBegin:function(event){\r\n        console.info(\"begin\")\r\n       // 调用声音引擎播放声音\r\n    //    cc.log(cc.audioEngine.getEffectsVolume)\r\n       cc.audioEngine.play(this.pullAudio, false,2);\r\n    },\r\n\r\n    touchMove:function(event){\r\n        console.info(\"move\")\r\n        //如果空竹比绳子高，则不能往上拉动\r\n    },\r\n\r\n    /**\r\n     * 放手后，与当前左右连接点解绑\r\n     * 空竹沿着两边固定点的中心方向射出\r\n     * 初速度与拉伸程度有关\r\n     * @param {*} event \r\n     */\r\n\r\n    //计算速度向量\r\n    calV2:function(){\r\n        // var biabolo_v2=this.rigidbody.getWorldVector();\r\n        // var rope_v2=this.rope.getWorldVector();\r\n        var k=5.5//系数，可调\r\n        // var f1=this.leftJoint.getReactionForce(1)//获取反作用力\r\n        // var f2=this.rightJoint.getReactionForce(1)\r\n        var leftnode_wp=this.leftNode.convertToWorldSpaceAR(cc.v2(0,0))//左节点的世界坐标向量\r\n        var rightnode_wp=this.rightNode.convertToWorldSpaceAR(cc.v2(0,0))\r\n        var diabolo_wp=this.node.convertToWorldSpaceAR(cc.v2(0,0))\r\n        var f1=leftnode_wp.sub(diabolo_wp)//左上拉力向量\r\n        var f2=rightnode_wp.sub(diabolo_wp)\r\n        var result_v2=f1.add(f2)\r\n        result_v2=result_v2.scale(cc.v2(k,k))//乘一个系数，放大作用力\r\n        // cc.log(f1)\r\n        // cc.log(f2)\r\n        // cc.log(result_v2)\r\n        return result_v2\r\n    },\r\n\r\n    touchEnd:function(event){\r\n        console.info(\"end\")\r\n        if(!this.isFly){\r\n            //给个初速度向量，相当于射出去\r\n            this.rigidbody.linearVelocity=this.calV2()\r\n            //删除两端连接点\r\n            this.cancelLRJoint()\r\n            //删除拉动点mouseJoint\r\n            this.mouseJoint.destroy()\r\n            this.mouseJoint=null\r\n            //设置为飞行状态\r\n            this.isFly=true\r\n            //开门\r\n            this.physicsBoxCollider.enabled=false\r\n            // 调用声音引擎播放声音\r\n            cc.audioEngine.play(this.popupAudio, false,1);\r\n        }\r\n        // this.bandMouseJoint()\r\n        // cc.log(this.mouseJoint)\r\n    },\r\n\r\n    //取消左右节点绑定\r\n    cancelLRJoint:function(){\r\n        // this.rope=null\r\n        this.leftJoint.enabled=false\r\n        this.leftJoint.connectedBody=null\r\n        this.rightJoint.enabled=false\r\n        this.rightJoint.connectedBody=null\r\n        this.leftJoint.apply()\r\n        this.rightJoint.apply()\r\n    },\r\n\r\n    \r\n\r\n    update (dt) {\r\n        //如果正在飞行，则y等于节点的y\r\n        if(this.isFly&&this.node.y>this.camera.y+this.camera.parent.height/2){\r\n            this.y=this.node.y\r\n        }\r\n        else if(!this.isFly){\r\n            // this.rope!=null&&\r\n            if(this.rope!=null&&this.rope.isValid){\r\n                this.y=this.rope.y\r\n            } else if(!this.rope.isValid){//如果所在的绳子消失\r\n                if(this.mouseJoint!=null){\r\n                    this.mouseJoint.destroy()//取消拉动\r\n                    this.mouseJoint=null\r\n                    //设置为飞行状态\r\n                    this.isFly=true\r\n                }\r\n            }\r\n        }\r\n\r\n        if(this.node.isValid){\r\n            if(this.node.y<this.camera.y-this.camera.parent.height/2-10){\r\n                this.node.destroy()\r\n            }\r\n        }\r\n        // cc.log(this.rope)\r\n        if((this.rope!=null)&& this.rope.isValid && (this.ropes.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(cc.v2(0,0))).y >this.rope.y)){\r\n            // cc.log(\"sss\"+this.ropes.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(cc.v2(0,0))).y)\r\n            // cc.log(\"aaa\"+this.rope.y)\r\n            this.rope = null\r\n        }\r\n    },\r\n});\r\n"]}