{"version":3,"sources":["rope.js"],"names":["cc","Class","extends","Component","properties","physicsBoxCollider","diabolo","diaboloComponent","diaboloEffect","used","camera","leftNode","rightNode","leftJoint","default","type","AudioClip","onLoad","find","node","getComponent","PhysicsBoxCollider","getChildByName","DistanceJoint","rightJoint","enabled","start","bandLRJoint","log","connectedBody","rigidbody","apply","rope","bandMouseJoint","addComponent","MouseJoint","mouseJoint","onCollisionEnter","other","self","onCollisionExit","console","linearVelocity","y","isFly","big","small","smallOrBigTime","update","dt"],"mappings":"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","file":"rope.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        physicsBoxCollider:null,//物理碰撞\r\n        diabolo:null,//空竹\r\n        diaboloComponent:null,\r\n        diaboloEffect:null,//道具效果\r\n        used:false,//是否使用过\r\n        camera:null,\r\n        leftNode:null,//左连接点\r\n        rightNode:null,//右连接点\r\n        leftJoint:null,//左distanceJoint组件\r\n        leftJoint:null,//右distanceJoint组件\r\n        downToRopeAudio: {\r\n            default: null,\r\n            type: cc.AudioClip\r\n        },//落在绳子上音效\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.diabolo=cc.find(\"Canvas/diabolo\")\r\n        //\r\n        this.physicsBoxCollider=this.node.getComponent(cc.PhysicsBoxCollider)\r\n        //\r\n        this.diaboloComponent=this.diabolo.getComponent(\"diabolo\")\r\n        this.diaboloEffect=this.diabolo.getComponent('diabolo_effect')\r\n        this.camera=cc.find(\"Canvas/Main Camera\")\r\n\r\n        this.leftNode=this.node.getChildByName(\"left\")\r\n        this.rightNode=this.node.getChildByName(\"right\")\r\n        //绑定左右distanceJoint组件\r\n        this.leftJoint=this.leftNode.getComponent(cc.DistanceJoint)\r\n        this.rightJoint=this.rightNode.getComponent(cc.DistanceJoint)\r\n        this.physicsBoxCollider.enabled=false\r\n    },\r\n\r\n    start () {\r\n        \r\n    },\r\n\r\n    //绑定左右节点\r\n    bandLRJoint:function(){\r\n        cc.log(\"bandLRJoint\")\r\n        //连接\r\n        this.leftJoint.connectedBody=this.diaboloComponent.rigidbody\r\n        this.rightJoint.connectedBody=this.diaboloComponent.rigidbody\r\n        this.leftJoint.enabled=true\r\n        this.rightJoint.enabled=true\r\n        this.leftJoint.apply()//修改之后需要apply()才能真正设置完成\r\n        this.rightJoint.apply()\r\n        //重新设置空竹的属性\r\n        this.diaboloComponent.rope=this.node\r\n        this.diaboloComponent.leftNode=this.leftNode\r\n        this.diaboloComponent.rightNode=this.rightNode\r\n        this.diaboloComponent.leftJoint=this.leftJoint\r\n        this.diaboloComponent.rightJoint=this.rightJoint\r\n        this.diaboloComponent.physicsBoxCollider=this.physicsBoxCollider\r\n    },\r\n\r\n    //重新绑定mousejoint\r\n    bandMouseJoint:function(){\r\n        this.diabolo.addComponent(cc.MouseJoint)//添加组件\r\n        this.diaboloComponent.mouseJoint=this.diabolo.getComponent(cc.MouseJoint)\r\n    },\r\n\r\n    onCollisionEnter:function(other,self){\r\n        cc.log('enter')\r\n    },\r\n\r\n    //如果检测到与绳子发生碰撞，则建立两边点的链接，并将绑定mousejoint，飞行状态设为false\r\n    //结束碰撞时，如果空竹是往下落的，则添加绳子\r\n    onCollisionExit: function (other, self) {\r\n        console.log('on collision exit');\r\n        \r\n\r\n        if(this.diaboloComponent.rigidbody.linearVelocity.y<0&&this.diaboloComponent.isFly){\r\n            //变大或变小后，需要跳跃两次未跳到过的绳子上才能解除\r\n            if(!this.used){\r\n                // cc.log(\"使用过\")\r\n                if(this.diaboloEffect.big||this.diaboloEffect.small){\r\n                  this.diaboloEffect.smallOrBigTime--\r\n                }\r\n                // cc.log(this.diaboloEffect.smallOrBigTime)\r\n                //设置已使用\r\n                this.used=true\r\n            }\r\n            //绑定左右节点\r\n            this.bandLRJoint()\r\n            //绑定mouseJoint\r\n            this.bandMouseJoint()\r\n            // other.enabled=false\r\n            this.diaboloComponent.isFly=false//固定在绳子上\r\n            //关门\r\n            this.physicsBoxCollider.enabled=true\r\n            // 调用声音引擎播放声音\r\n            // cc.audioEngine.playEffect(this.downToRopeAudio, false);\r\n        }\r\n\r\n\r\n    },\r\n\r\n    update (dt) {\r\n        //如果空竹在上面，则开门\r\n        //空竹弹出后，开门\r\n        //其他情况，关门\r\n        //cc.log(this.diabolo.isFly)\r\n        //if(this.on)\r\n        // cc.log(this.node.isValid)\r\n\r\n        // if(this.node.isValid){//如果还存在\r\n        //     if(this.node.y<this.diabolo.y&&this.physicsBoxCollider.enabled&&this.diaboloComponent.isFly){\r\n        //         //cc.log(1)\r\n        //         this.physicsBoxCollider.enabled=false\r\n        //     }\r\n        //     else if(!this.diaboloComponent.isFly&&!this.physicsBoxCollider.enabled){\r\n        //         this.physicsBoxCollider.enabled=true\r\n        //     }\r\n        // }\r\n        \r\n    },\r\n});\r\n"]}